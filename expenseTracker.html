<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <div id="app">
        <h1>Expense Tracker</h1>
        <h2 style="border: 3px solid khaki; padding: 10px;">
            Total All-Time Expenses: {{ calculateTotalExpenses().toFixed(2) }}‚Ç¨
        </h2>

        
        <div style="margin: 20px 0; padding: 15px; background: #f5f5f5;">
            <h3>Monthly Totals:</h3>
            <div v-for="(total, month) in monthlyTotals" :key="month"
                style="padding: 8px; border-bottom: 1px solid #ddd;">
                {{ month }}: {{ total.toFixed(2) }}‚Ç¨
            </div>
        </div>

        <div v-for="expense in expenses" :key="expense.id"
            style="padding: 0 10px; 
            border: 1px solid black; 
            display: flex; 
            flex-direction: row; 
            align-items: center; 
            gap: 10px; 
            margin-bottom: 10px;">

            <button v-on:click="removeExpenses(expense)">‚ùå</button>
            <button v-on:click="expense.isEditing = !expense.isEditing">{{ expense.isEditing ? 'üíæ' : '‚úèÔ∏è' }}</button>

            <div v-if="!expense.isEditing" style="display:flex; gap:8px; align-items:center;">
                <p>{{ expense.description }}, {{ expense.price }}, {{ expense.date }}</p>
            </div>

            <div v-else style="display:flex; gap:8px; align-items:center;">
                <input v-model="expense.description" type="text" style="margin: 0 5px;">
                <input v-model.number="expense.price" type="number" step="0.01" style="width:100px;">
                <input v-model="expense.date" type="date">
            </div>
        </div>

        <div style="border: 3px solid pink; padding: 10px;">
            <input v-model="newExpensesText" type="text" style="margin: 15px;" placeholder="description">
            <input v-model.number="newExpensesPrice" type="number" step="0.01" placeholder="price">
            <input v-model="newExpensesDate" type="date" style="margin: 15px;">
            <button v-on:click="addNewExpense()">Add Expense</button>

        </div>

        <p style="color:red; font-size: 100px;">{{alertMessage}}</p>
    </div>

    <script type="module">
        import {createApp} from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js'

        createApp({
            created() {
                
                const savedExpenses = localStorage.getItem('expenses');
                if (savedExpenses) {
                    this.expenses = JSON.parse(savedExpenses);
                }
            },
            computed: {
                monthlyTotals() {
                    const totals = {};
                    this.expenses.forEach(expense => {
                        const date = new Date(expense.date);
                        const monthYear = date.toLocaleString('default', { month: 'long', year: 'numeric' });
                        totals[monthYear] = (totals[monthYear] || 0) + Number(expense.price);
                    });
                    return totals;
                }
            },
            methods: {
                addNewExpense() {
                    if (!this.newExpensesText || this.newExpensesPrice === null || !this.newExpensesDate) {
                        this.alertMessage = 'Please fill in all fields.';
                        return;
                    }
                    
                    const nextId = this.expenses.length ? Math.max(...this.expenses.map(e => e.id)) + 1 : 1;
                    this.expenses.push({
                        id: nextId,
                        description: this.newExpensesText.trim(),
                        price: this.newExpensesPrice,
                        date: this.newExpensesDate,
                        isEditing: false,
                    });
                    
                    
                    this.saveToLocalStorage();
                    
                    
                    this.newExpensesText = '';
                    this.newExpensesPrice = null;
                    this.newExpensesDate = '';
                    this.alertMessage = '';
                },
                removeExpenses(itemToRemove) {
                    const idx = this.expenses.findIndex(item => item.id === itemToRemove.id);
                    if (idx !== -1) {
                        this.expenses.splice(idx, 1);
                        this.saveToLocalStorage();
                    }
                },
                calculateTotalExpenses() {
                    let total = 0;
                    this.expenses.forEach(expense => {
                        total += Number(expense.price) || 0;
                    });
                    return total;
                },
                saveToLocalStorage() {
                    localStorage.setItem('expenses', JSON.stringify(this.expenses));
                }
            },
            data() {
                return {
                    alertMessage: '',
                    newExpensesText: '',
                    newExpensesPrice: null,
                    newExpensesDate: '',
                    expenses: [{
                        id: 1,
                        description: 'jedlo',
                        price: 10.5,
                        date: '2024-06-01',
                        isEditing: false,
                    }],
                }
            },

        }).mount('#app');
    </script>
</body>

</html>
